<div class="column-filter-wrapper">
  <button 
    class="filter-trigger" 
    [class.has-filter]="hasActiveFilter()"
    (click)="toggleDropdown($event)"
    [attr.aria-label]="'Filter by ' + columnName"
    [attr.aria-expanded]="showDropdown">
    <!-- <i class="fas fa-filter"></i> -->
    <svg *ngIf="!hasActiveFilter()" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" data-p-icon="filter" class="ng-tns-c389539309-46 p-icon ng-star-inserted" pc164=""><g clip-path="url(#pui_id_9)"><path d="M8.64708 14H5.35296C5.18981 13.9979 5.03395 13.9321 4.91858 13.8167C4.8032 13.7014 4.73745 13.5455 4.73531 13.3824V7L0.329431 0.98C0.259794 0.889466 0.217389 0.780968 0.20718 0.667208C0.19697 0.553448 0.219379 0.439133 0.271783 0.337647C0.324282 0.236453 0.403423 0.151519 0.500663 0.0920138C0.597903 0.0325088 0.709548 0.000692754 0.823548 0H13.1765C13.2905 0.000692754 13.4021 0.0325088 13.4994 0.0920138C13.5966 0.151519 13.6758 0.236453 13.7283 0.337647C13.7807 0.439133 13.8031 0.553448 13.7929 0.667208C13.7826 0.780968 13.7402 0.889466 13.6706 0.98L9.26472 7V13.3824C9.26259 13.5455 9.19683 13.7014 9.08146 13.8167C8.96609 13.9321 8.81022 13.9979 8.64708 14ZM5.97061 12.7647H8.02943V6.79412C8.02878 6.66289 8.07229 6.53527 8.15296 6.43177L11.9412 1.23529H2.05884L5.86355 6.43177C5.94422 6.53527 5.98773 6.66289 5.98708 6.79412L5.97061 12.7647Z" fill="currentColor"></path></g><defs><clipPath id="url(#pui_id_9)"><rect width="14" height="14" fill="white"></rect></clipPath></defs></svg>

    <svg *ngIf="hasActiveFilter()" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" data-p-icon="filter-fill" class="ng-tns-c389539309-50 p-icon ng-star-inserted" pc2469=""><path d="M13.7274 0.33847C13.6228 0.130941 13.4095 0 13.1764 0H0.82351C0.590451 0 0.377157 0.130941 0.272568 0.33847C0.167157 0.545999 0.187746 0.795529 0.325275 0.98247L4.73527 6.99588V13.3824C4.73527 13.7233 5.01198 14 5.35292 14H8.64704C8.98798 14 9.26469 13.7233 9.26469 13.3824V6.99588L13.6747 0.98247C13.8122 0.795529 13.8328 0.545999 13.7274 0.33847Z" fill="currentColor"></path></svg>
  </button>



  <div class="filter-dropdown" *ngIf="showDropdown">
    <div class="filter-dropdown-content">
      <!-- Global Match Mode Toggle (only shown when multiple rules exist) -->
      <div class="global-match-mode-toggle" *ngIf="hasMultipleRules()">
        <label class="match-mode-label">Combine rules:</label>
        <div class="match-mode-switch-wrapper">
          <div 
            class="match-mode-switch" 
            [class.match-all]="globalMatchMode === 'match-all-rules'"
            (click)="toggleGlobalMatchMode()">
            <span class="match-mode-text">{{ getGlobalMatchModeLabel() }}</span>
            <i class="fas fa-chevron-down match-mode-arrow"></i>
          </div>
          <div class="match-mode-options" *ngIf="false">
            <!-- Dropdown options if needed in future -->
          </div>
        </div>
      </div>

      <!-- Filter Rules -->
      <div class="filter-rules">
        <div *ngFor="let rule of filterRules; let i = index" class="filter-rule">
          
          <!-- First dropdown - Match type -->
          <div class="dropdown-select-wrapper" [class.first-rule]="i === 0">
            <select 
              class="dropdown-select"
              [(ngModel)]="rule.matchType"
              [attr.aria-label]="'Match type for rule ' + (i + 1)">
              <option *ngFor="let type of matchTypes" [value]="type.value" [selected]="rule.matchType === type.value">
                {{ type.label }}
              </option>
            </select>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </div>

          <!-- Text Input -->
          <input 
            *ngIf="isTextField()"
            type="text" 
            class="filter-input"
            [placeholder]="getPlaceholder()"
            [(ngModel)]="rule.value"
            [attr.aria-label]="'Filter value for rule ' + (i + 1)">

          <!-- Currency Input -->
          <div *ngIf="isCurrencyField()" class="currency-input-wrapper">
            <span class="currency-symbol">{{ currencySymbol }}</span>
            <input 
              type="text" 
              class="filter-input currency-input"
              [placeholder]="'0.00'"
              [value]="formatCurrency(rule.value)"
              (input)="rule.value = parseCurrency($any($event.target).value)"
              [attr.aria-label]="'Currency filter value for rule ' + (i + 1)">
          </div>

          <!-- Age/Number Input -->
          <input 
            *ngIf="isAgeField()"
            type="number" 
            class="filter-input age-input"
            [placeholder]="'Enter number'"
            [(ngModel)]="rule.value"
            min="0"
            step="1"
            [attr.aria-label]="'Age/Number filter value for rule ' + (i + 1)">

          <!-- Date Input -->
          <input 
            *ngIf="isDateField()"
            type="date" 
            class="filter-input date-input"
            [placeholder]="'Select date'"
            [(ngModel)]="rule.value"
            [attr.aria-label]="'Date filter value for rule ' + (i + 1)">

          <!-- Status Dropdown -->
          <div *ngIf="isStatusField()" class="dropdown-select-wrapper status-dropdown-wrapper">
            <select 
              class="dropdown-select status-select"
              [(ngModel)]="rule.value"
              [attr.aria-label]="'Status filter value for rule ' + (i + 1)">
              <option value="">Select status</option>
              <option *ngFor="let option of statusOptions" [value]="option">
                {{ option }}
              </option>
            </select>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </div>

          <!-- Remove Rule button (only for additional rules) -->
          <button 
            *ngIf="filterRules.length > 1 && i > 0"
            class="remove-rule-btn"
            (click)="removeRule(i)"
            type="button"
            [attr.aria-label]="'Remove filter rule ' + (i + 1)">
            <i class="fas fa-trash"></i> Remove Rule
          </button>
        </div>
      </div>

      <!-- Add Rule button -->
      <button class="add-rule-btn" (click)="addRule()" type="button" aria-label="Add another filter rule">
        <span class="plus-icon">+</span> Add Rule
      </button>

      <!-- Action buttons -->
      <div class="filter-actions">
        <button class="btn-clear" (click)="clearFilter()" type="button">Clear</button>
        <button class="btn-apply" (click)="applyFilter()" type="button">Apply</button>
      </div>
    </div>
  </div>
</div>